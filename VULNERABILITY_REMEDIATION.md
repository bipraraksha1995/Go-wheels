# ðŸš¨ Vulnerability Reporting & Remediation Guide

## Overview

This guide explains how to handle vulnerabilities found by automated scanning tools and document your security decisions.

---

## Vulnerability Lifecycle

```
1. Detection (pip-audit/Safety/Trivy)
        â†“
2. Assessment (Severity, Impact, Applicability)
        â†“
3. Triage (Ignore/Fix/Defer)
        â†“
4. Remediation (Update/Patch/Workaround)
        â†“
5. Verification (Rescan & Test)
        â†“
6. Documentation (Update exception list)
```

---

## Severity Levels & Response Time

| Level | CVSS | Description | Action | Timeline |
|-------|------|-------------|--------|----------|
| ðŸ”´ **Critical** | 9.0-10.0 | Allows remote code execution | Patch immediately | 24-48 hours |
| ðŸŸ  **High** | 7.0-8.9 | Allows unauthorized access | Patch urgently | 1 week |
| ðŸŸ¡ **Medium** | 4.0-6.9 | Limited impact, requires conditions | Plan patch | 2-4 weeks |
| ðŸŸ¢ **Low** | 0.1-3.9 | Minimal impact | Monitor | 30 days |

---

## Step-by-Step Remediation

### 1. Identify Vulnerability

#### Run Scan
```bash
pip-audit --verbose
```

#### Output Example:
```
Name: requests
Version: 2.25.0
ID: GHSA-7wfx-fcpm-jpf5
Fix Version: 2.31.0
Description: Unintended leak of Proxy-Authorization header
```

### 2. Understand the Vulnerability

#### Check Vulnerability Details
```bash
# Get more info
pip-audit --desc
```

#### Visit Official Resources
- **GitHub Advisory**: https://github.com/advisories/GHSA-7wfx-fcpm-jpf5
- **CVE Database**: https://nvd.nist.gov/vuln/detail/CVE-2023-32681
- **Package Repo**: https://github.com/psf/requests/security/advisories

### 3. Assess Impact

**Questions to Ask:**
- Does your app use the affected feature?
- Do your deployment conditions match vulnerability conditions?
- Is the package even required?

**Example:**
```
Vulnerability: SQL Injection in Django ORM
Your Code: Only using Django queryset with .filter(id=user_id)
Impact: LOW (parameterized queries prevent exploitation)
```

### 4. Choose Action

#### Option A: Update Package (Recommended)
```bash
# Find latest version
pip install --upgrade requests

# Or specific version
pip install requests==2.31.0

# Update requirements.txt
pip freeze > requirements.txt

# Verify fix
pip-audit
```

#### Option B: Ignore (Documented Exception)
```bash
# Add to pyproject.toml
# [tool.pip-audit]
# ignore = ["GHSA-7wfx-fcpm-jpf5"]
```

#### Option C: Workaround (If update not available)
```python
# Example: Disable risky feature
# Instead of: requests.get(url, verify=False)  # âŒ Insecure
# Do this:
requests.get(url, verify=True)  # âœ… Verify SSL certificates
```

#### Option D: Remove Package (If not needed)
```bash
pip uninstall requests
# Update requirements.txt
pip freeze > requirements.txt
```

---

## Documenting Decisions

### Create VULNERABILITY_EXCEPTIONS.md

```markdown
# Known Vulnerabilities - Accepted Risk

## 1. GHSA-7wfx-fcpm-jpf5 (requests)

**Package:** requests
**Version:** 2.25.0
**CVE:** CVE-2023-32681
**Severity:** Medium
**CVSS Score:** 6.2

### Vulnerability
Unintended leak of Proxy-Authorization header when redirected to a different host

### Why We Accept This
- We don't use proxy authentication in our application
- All requests use HTTPS with direct connections
- No sensitive proxy headers are transmitted

### Accepted By
- Security Team Lead (name)
- Date: 2024-01-15

### Review Schedule
- Next Review: 2024-04-15 (90 days)
- Upgrade Check: When requests 2.32+ stable released

### Remediation Plan
- Monitor upstream for patch release
- Update when version reaches stable
- No interim action required

---

## 2. GHSA-xxxx-xxxx-xxxx (package-name)

[Same structure...]
```

### Add to .gitignore
```
VULNERABILITY_EXCEPTIONS.md  # Track changes
```

---

## Handling False Positives

### Example: Bandit False Positive

```bash
# Error: B101 - assert_used
def test_something():
    assert True  # âŒ Bandit flagged this
```

**Solution:**
```python
# In .pre-commit-config.yaml
- id: bandit
  args: [--skip=B101]  # Skip assert_used in tests
```

---

## GitHub Actions Response

### Automatic Actions
âœ… **On Vulnerability Detected:**
- PR gets red âŒ status check
- Cannot merge without approval
- Slack notification sent
- GitHub issue auto-created

### Manual Override
```bash
# Only for emergency bypass (rare)
git commit --no-verify  # Skips pre-commit hooks
```

**âš ï¸ Not Recommended** - Document why if used

---

## Reporting Vulnerabilities to Package Maintainers

If you discover a 0-day vulnerability:

### 1. **DO NOT** Post Publicly
```
âŒ Don't: Post on Twitter/GitHub issues/Stack Overflow
âœ… Do: Contact maintainers privately
```

### 2. Email Maintainer
```
To: security@example.com (if they have one)
Subject: Security Vulnerability in [Package] [Version]

[Describe issue]
```

### 3. Provide Details
- Affected versions
- Reproduction steps
- Impact assessment
- Suggested fix

### 4. Give Timeline
- Responsible disclosure: 90 days
- Allow time for patch
- Then public disclosure

---

## Continuous Monitoring

### Weekly Manual Scan
```bash
#!/bin/bash
# save as: scripts/security-scan.sh

DATE=$(date +%Y-%m-%d)
echo "ðŸ” Running security scans at $DATE"

# pip-audit
pip-audit --verbose > "reports/pip-audit-$DATE.json"

# Safety
safety check --json > "reports/safety-$DATE.json"

# Trivy
docker build -t gowheels:latest .
trivy image --format json --output "reports/trivy-$DATE.json" gowheels:latest

echo "âœ… Scans complete. Reports saved to reports/"
```

### Run Weekly
```bash
chmod +x scripts/security-scan.sh
0 2 * * 1 /path/to/scripts/security-scan.sh  # Every Monday 2 AM
```

---

## Creating Exception Baseline (detect-secrets)

```bash
# Initialize baseline
detect-secrets scan > .secrets.baseline

# Pre-commit will check against this
# If you add legitimate non-secret values that trigger:
detect-secrets scan --baseline .secrets.baseline
```

---

## Integration with Your Workflow

### Local Development
```bash
# Install pre-commit hooks
pre-commit install

# Before commit - automatic scan
git commit -m "message"  # Scans dependencies, code, configs

# Run manually anytime
pre-commit run --all-files
```

### Pull Request
1. Push code â†’ GitHub Actions runs
2. Vulnerabilities found â†’ PR marked red
3. Fix required before merge
4. Green check â†’ Can merge

### Production Release
1. Run comprehensive scan
2. Document any accepted risks
3. Update VULNERABILITY_EXCEPTIONS.md
4. Notify security team
5. Deploy with confidence

---

## Command Reference

### Scan Commands
```bash
# pip-audit
pip-audit                          # Quick scan
pip-audit --verbose                # Detailed
pip-audit --fix                    # Auto-fix
pip-audit --format json            # JSON output
pip-audit --ignore GHSA-xxxx-xxxx  # Skip vulnerability

# Safety
safety check                        # Quick scan
safety check --json                # JSON output
safety check --full-report         # Detailed

# Bandit
bandit -r gowheels/               # Scan directory
bandit gowheels/views.py          # Scan file
bandit -f json gowheels/ > report.json  # JSON output

# Pre-commit
pre-commit run --all-files        # Run all hooks
pre-commit run pip-audit          # Run specific hook
pre-commit install               # Install hooks
```

### Document Commands
```bash
# Create exception
echo "GHSA-xxxx-xxxx-xxxx" >> VULNERABILITY_EXCEPTIONS.md

# View scan history
ls -la reports/

# Compare scans
diff reports/pip-audit-2024-01-01.json reports/pip-audit-2024-01-15.json
```

---

## Metrics & Reporting

### Track Over Time
```bash
# Create dashboard data
DATE=$(date +%Y-%m-%d)
VULN_COUNT=$(pip-audit --format json | jq '.vulnerabilities | length')
echo "$DATE,$VULN_COUNT" >> vulnerability-metrics.csv
```

### Sample Metrics Report
```
Date        Critical  High  Medium  Low
2024-01-01  0        1     3      5
2024-01-08  0        1     2      4
2024-01-15  0        0     1      3
```

**Goal:** Trend toward 0 vulnerabilities

---

## Escalation Path

### If Vulnerability Remains Unfixed

```
1. Assess: Is it really unfixable?
2. Escalate: Contact package maintainer
3. Workaround: Can we code around it?
4. Alternative: Is there a better package?
5. Accept: Document risk & get approval
6. Monitor: Schedule re-assessment
```

### Decision Template
```
Vulnerability: [Name & ID]
Status: [Open/Unfixed/Waiting]
Assignee: [Name]
Priority: [Critical/High/Medium/Low]
Target Resolution Date: [Date]
Escalation Level: [Team/Manager/Director]
```

---

## Resources

- [pip-audit FAQ](https://github.com/pypa/pip-audit)
- [Safety Documentation](https://docs.safetycli.com/)
- [Bandit Security Codes](https://bandit.readthedocs.io/en/latest/blacklists/index.html)
- [OWASP Vulnerability Scoring](https://www.owasp.org/index.php/CVSS)
- [GitHub Security Advisory](https://github.com/advisories)

---

**Status:** ðŸ“‹ Process defined for handling vulnerabilities responsibly
